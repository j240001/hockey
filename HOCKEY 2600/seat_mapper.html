<!DOCTYPE html>
<html>
<head>
    <title>Zoomable Rink Seat Mapper</title>
    <style>
        body { background: #222; color: #eee; font-family: sans-serif; text-align: center; margin: 0; padding: 20px; }
        #canvas-container { 
            width: 90vw; height: 70vh; 
            overflow: auto; margin: 0 auto; 
            border: 2px solid #00ff00; background: #000;
        }
        canvas { cursor: crosshair; display: block; transform-origin: top left; }
        .ui { background: #333; padding: 15px; border-bottom: 2px solid #444; margin-bottom: 10px; }
        textarea { width: 80%; height: 80px; margin-top: 10px; background: #111; color: #0f0; font-family: monospace; }
        button { padding: 8px 15px; cursor: pointer; font-weight: bold; margin: 5px; }
        input[type="range"] { vertical-align: middle; width: 200px; }
    </style>
</head>
<body>
    <div class="ui">
        <strong>1. Load .png:</strong> <input type="file" id="imageLoader" accept="image/*">
        | <strong>2. Zoom:</strong> <input type="range" id="zoom" min="1" max="4" step="0.1" value="1"> <span id="zoomVal">1.0x</span>
        <br><br>
        <button onclick="clearLast()">Undo Last</button>
        <button onclick="copyToClipboard()">Copy Array</button>
        <textarea id="output" readonly placeholder="Coordinate array output..."></textarea>
    </div>
    
    <div id="canvas-container">
        <canvas id="mapper" width="1000" height="600"></canvas>
    </div>

    <script>
        const canvas = document.getElementById('mapper');
        const ctx = canvas.getContext('2d');
        const output = document.getElementById('output');
        const loader = document.getElementById('imageLoader');
        const zoomSlider = document.getElementById('zoom');
        const zoomVal = document.getElementById('zoomVal');
        
        let seats = [];
        let img = new Image();
        let currentZoom = 1;

        // Handle Image Upload
        loader.onchange = function(e) {
            const reader = new FileReader();
            reader.onload = (event) => {
                img.onload = () => update();
                img.src = event.target.result;
            }
            reader.readAsDataURL(e.target.files[0]);
        }

        // Handle Zoom
        zoomSlider.oninput = function() {
            currentZoom = parseFloat(this.value);
            zoomVal.innerText = currentZoom.toFixed(1) + "x";
            canvas.style.width = (1000 * currentZoom) + "px";
            canvas.style.height = (600 * currentZoom) + "px";
        };

        canvas.onclick = function(e) {
            if (!img.src) return alert("Upload your rink PNG first!");
            const rect = canvas.getBoundingClientRect();
            
            // MATH: Adjust click by current zoom to get original 1000x600 coord
            const rawX = (e.clientX - rect.left) / currentZoom;
            const rawY = (e.clientY - rect.top) / currentZoom;
            
            seats.push({ x: Math.round(rawX), y: Math.round(rawY) });
            update();
        };

        function update() {
            ctx.clearRect(0, 0, 1000, 600);
            if (img.src) ctx.drawImage(img, 0, 0, 1000, 600);
            
            // Draw red dots
            ctx.fillStyle = "red";
            seats.forEach(s => {
                ctx.beginPath();
                ctx.arc(s.x, s.y, 3, 0, Math.PI * 2);
                ctx.fill();
            });
            output.value = JSON.stringify(seats);
        }

        function clearLast() {
            seats.pop();
            update();
        }

        function copyToClipboard() {
            output.select();
            document.execCommand('copy');
            alert("Array copied!");
        }
    </script>
</body>
</html>